{% extends 'base.html' %}

{% block title %}
    <title>{{ request.user.username }}的详情页</title>
{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href="/static/blog/css/article_detail.css">
{% endblock css %}

{% block content %}
    {% csrf_token %}
    <div class="article_info">
        <h3 class="text-center title">{{ article_obj.title }}</h3>
        <div class="text_content">
            {{ article_obj.content | safe }}
        </div>


        <div id="div_digg">
            <div class="diggit action">
                <span class="diggnum" id="digg_count">{{ article_obj.up_count }}</span>
            </div>
            <div class="buryit action">
                <span class="burynum" id="bury_count">{{ article_obj.down_count }}</span>
            </div>
            <div class="clear"></div>
            <div class="diggword" id="digg_tips"></div>
        </div>
    </div>

    <script>
        $('#div_digg .action').click(function () {
            let is_up = $(this).hasClass('diggit');

            $.ajax({
                url: '/digg/',
                type: 'post',
                data: {
                    'csrfmiddlewaretoken': $("[name='csrfmiddlewaretoken']").val(),
                    'is_up': is_up,
                    'article_id': "{{ article_obj.pk }}",
                },
                success: function (data) {
                    if (data.status) {
                        if (is_up) {
                            let val = parseInt($('#digg_count').text());
                            $('#digg_count').text(val + 1);

                        } else {
                            let val = parseInt($('#bury_count').text());
                            $('#bury_count').text(val + 1);
                        }


                    } else {
                        if (data.handled) {
                            $('#digg_tips').html('您已经推荐过！');
                        } else {
                            $('#digg_tips').html('您已经反对过！');
                        }

                        setTimeout(function () {
                            $('#digg_tips').html("");
                        }, 1000)

                    }
                }
            })
        })

    </script>
{% endblock content %}